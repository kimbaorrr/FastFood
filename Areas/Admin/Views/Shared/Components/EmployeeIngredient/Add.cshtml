@{
	@model AddInventoryInViewModel
	var ingredients = ViewBag.Ingredient as SelectList;
}

<div class="card">
	<div class="card-header">
		<h3 class="card-title">Thêm phiếu nhập</h3>
	</div>
	<div class="card-body">
		@using (Html.BeginForm("WareHouse", "Ingredient", FormMethod.Post, new { area = "Admin", id = "createIngredientForm" }))
		{
			@Html.AntiForgeryToken()
			<div class="form-group mb-2">
				<div class="form-check pb-1">
					<input class="form-check-input" type="radio" name="feature" id="addIngredient" checked>
					<label class="form-check-label" for="addIngredient">
						Thêm nguyên liệu mới
					</label>
				</div>
				<div class="form-check pb-1">
					<input class="form-check-input" type="radio" name="feature" id="selectedIngredient">
					<label class="form-check-label" for="selectedIngredient">
						Chọn nguyên liệu có sẵn
					</label>
				</div>
			</div>
			<div class="form-group mb-2" id="ingredientName">
				@Html.LabelFor(x => x.IngredientName, new { @class = "form-label" }) <span class="text-red"> *</span>
				@Html.TextBoxFor(x => x.IngredientName, new { @class = "form-control", @autofocus = "" })
			</div>

			<div class="form-group mb-2" id="dropdownNguyenLieuDiv" style="display: none;">
				@Html.LabelFor(m => m.IngredientId, new { @class = "form-label" }) <span class="text-red"> *</span>
				@Html.DropDownListFor(m => m.IngredientId, ingredients, "Chọn nguyên liệu", new
					{
						@class = "form-control mt-1",
						@data_choices = "true",
						@data_choices_groups = "true",
						@data_placeholder = "Chọn nguyên liệu",
						@id = "nguyenLieuCoSan"
					})
			</div>

			<div class="form-group mb-2">
				@Html.LabelFor(x => x.Description, new { @class = "form-label" })
				@Html.TextBoxFor(x => x.Description, new { @class = "form-control" })
			</div>

			<div class="form-group mb-2">
				@Html.LabelFor(x => x.ReorderLevel, new { @class = "form-label" }) <span class="text-red"> *</span>
				@Html.TextBoxFor(x => x.ReorderLevel, new { @class = "form-control" })
			</div>

			<div class="form-group mb-2">
				@Html.LabelFor(x => x.Quantity, new { @class = "form-label" }) <span class="text-red"> *</span>
				@Html.TextBoxFor(x => x.Quantity, new { @class = "form-control", @type = "number", @min = "1" })
			</div>
			<div class="form-group mb-2">
				@Html.LabelFor(x => x.Unit, new { @class = "form-label" }) <span class="text-red"> *</span>
				@Html.TextBoxFor(x => x.Unit, new { @class = "form-control", @readonly = "" })
			</div>
			<div class="form-group mb-2">
				@Html.LabelFor(x => x.CreatedAt, new { @class = "form-label" })
				@Html.TextBoxFor(x => x.CreatedAt, new { @class = "form-control", @readonly = "" })
			</div>
			<button type="submit" class="btn btn-primary">Thêm phiếu nhập</button>
		}
	</div>
</div>

<script>
	$(document).ready(function () {
		$('#addIngredient').change(function () {
			$('#ingredientName').show();
			$('#dropdownNguyenLieuDiv').hide();
			$('#Description').show();
			$('#reorderLevel').show();
			$('label[for="Description"]').show();
			$('label[for="reorderLevel"]').show();
		});

		$('#selectedIngredient').change(function () {
			$('#ingredientName').hide();
			$('#dropdownNguyenLieuDiv').show();
			$('#Description').hide();
			$('#reorderLevel').hide();
			$('label[for="Description"]').hide();
			$('label[for="reorderLevel"]').hide();
		});


		$('#createIngredientForm').on('submit', function (e) {
			e.preventDefault();
			var formData = $(this).serialize();
			const url = $(this).attr("action");

			$.ajax({
				url: url,
				type: 'POST',
				dataType: 'json',
				data: formData,
				success: function (response) {
					alertMessage(response.message, response.type);
					if (response.success) {
						loadReceipt();
						loadInventory();
					}
				},
				error: function (xhr, status, error) {
					alert('Đã xảy ra lỗi khi tạo tài khoản.');
				}
			});
		});
	});
</script>

